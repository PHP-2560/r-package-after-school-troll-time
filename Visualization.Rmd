---
title: "Visualization"
author: "Chu Wu"
date: "11/21/2019"
output: html_document
---


```{r}
mtcars

```


```{r}
library(ggplot2)
library(plyr)
library(corrplot)
library(RColorBrewer)
```

# Scatterplot

```{r}
scatterplot <- function(data, xvar, yvar, ...) {
ggplot(data, aes(x=data[, xvar], y=data[, yvar], ...)) +   
  geom_point()  + 
  labs(title=paste(xvar, "vs.", yvar), x =xvar, y =yvar)+ 
  theme(plot.title = element_text(color = "black", size = 15, face = "bold",hjust = 0.5))
}
```

```{r}
scatterplot(mtcars, "disp", "hp" ,color=mtcars$carb, shape = mtcars$am)
```


```{r}
scatterplot_category <- function(data, xvar, yvar, ..., width=0.1, height=0.5 ) {
ggplot(data, aes(x=data[, xvar], y=data[, yvar], ...)) +   
# Jitter the points: Jitter range is 0.1 on the x-axis, .5 on the y-axis
  geom_point(position = position_jitter(width=width,height=height))  + 
  labs(title=paste(xvar, "vs.", yvar), x =xvar, y =yvar)+ 
  theme(plot.title = element_text(color = "black", size = 15, face = "bold",hjust = 0.5))
}
```

```{r}
scatterplot_category(mtcars, "am", "hp" ,color=mtcars$carb, shape = mtcars$am)
```


```{r}
scatterplot_regression <- function(data, xvar, yvar, ..., method="auto", se=TRUE,fullrange=TRUE) {
ggplot(data, aes(x=data[, xvar], y=data[, yvar], ...)) +   
  geom_point()  + 
  labs(title=paste(xvar, "vs.", yvar), x =xvar, y =yvar)+ 
  theme(plot.title = element_text(color = "black", size = 15, face = "bold",hjust = 0.5))+
  geom_smooth(method = method, se=se,fullrange = fullrange)   # Add a loess smoothed fit curve with confidence region 
                             #  (by default includes 95% confidence region)
}
```
```{r}
scatterplot_regression(mtcars, "disp", "hp" ,color=mtcars$carb)
```


```{r}
scatterplot_facet <- function(data, xvar, yvar, ..., fvar) {
ggplot(data, aes(x=data[, xvar], y=data[, yvar], ...)) +   
  geom_point()  + 
  labs(title=paste(xvar, "vs.", yvar, "by", fvar), x =xvar, y =yvar)+ 
  theme(plot.title = element_text(color = "black", size = 15, face = "bold",hjust = 0.5))+
  facet_grid(. ~ data[, fvar])  
}
```

```{r}
scatterplot_facet(mtcars, "disp", "hp" ,color=mtcars$carb, fvar="cyl")
```



# histogram
```{r}
histogram <- function(data, xvar, ..., binwidth=200, alpha=.5, position="identity"){
  ggplot(data, aes(x=data[,xvar],...)) +
  geom_histogram(binwidth=binwidth, alpha=alpha, position=position, colour="black")+ 
  labs(title=paste("Histogram of", xvar), x =xvar)+ 
  theme(plot.title = element_text(color = "black", size = 15, face = "bold",hjust = 0.5))+
    geom_vline(aes(xintercept=mean(data[,xvar], na.rm=T)),   # Ignore NA values for mean
               color="red", linetype="dashed", size=1)
}
```

```{r}
histogram(mtcars, xvar = "hp", fill = mtcars$cyl)
```



# Density plots
ggplot(dat, aes(x=rating, colour=cond)) + geom_density()

# Density plots with semi-transparent fill
ggplot(dat, aes(x=rating, fill=cond)) + geom_density(alpha=.3)

# densityplot

```{r}
# Histogram overlaid with kernel density curve
density <- function(data, xvar,..., binwidth=0.5){
  ggplot(data, aes(x=data[,xvar],...)) + 
  geom_density(alpha=.2)+  # Overlay with transparent density plot 
  labs(title=paste("Density plot of", xvar), x =xvar)+ 
  theme(plot.title = element_text(color = "black", size = 15, face = "bold",hjust = 0.5))+
    geom_vline(aes(xintercept=mean(data[,xvar], na.rm=T)),   # Ignore NA values for mean
               color="red", linetype="dashed", size=1)
}
```

```{r}
density(mtcars, xvar = "wt", fill=mtcars$cyl)
```

# barplot

```{r}
barplot <- function(data, xvar, position = "dodge",stat="identity",width=0.7,...) {
ggplot(data, aes(x=data[, xvar], ...)) +   
  geom_bar(position=position, stat=stat, width = width)  + 
  labs(title=paste("Bar plot by", xvar), x =xvar)+ 
  theme(plot.title = element_text(color = "black", size = 15, face = "bold",hjust = 0.5))
}
```
```{r}
barplot(mtcars, "am", y=mtcars$disp ,fill=mtcars$carb)
```

```{r}
barplot(mtcars, "carb", stat="count", fill=mtcars$am)
```

```{r}
horizontal_barplot <- function(data, xvar, position = "dodge",stat="identity",width=0.7,...) {
ggplot(data, aes(x=data[, xvar], ...)) +   
  geom_bar(position=position, stat=stat, width = width)  + 
  labs(title=paste("Bar plot by", xvar), x =xvar)+ 
  theme(plot.title = element_text(color = "black", size = 15, face = "bold",hjust = 0.5))+
  coord_flip()
}
```
```{r}
horizontal_barplot(mtcars, "am", y=mtcars$disp ,fill=mtcars$carb)
```

```{r}
barplot_facet <- function(data, xvar, position = "dodge",stat="identity",width=0.7,..., fvar) {
ggplot(data, aes(x=data[, xvar], ...)) +   
  geom_bar(position=position, stat=stat, width = width)  + 
  labs(title=paste("Bar plot by", xvar), x =xvar)+ 
  theme(plot.title = element_text(color = "black", size = 15, face = "bold",hjust = 0.5)) + 
  facet_grid(. ~ data[, fvar])  
}
```
```{r}
barplot_facet(mtcars, "am", y=mtcars$disp, fill=mtcars$carb, fvar="cyl")
```



# boxplot

```{r}
boxplot <- function(data, xvar, yvar, ...) {
ggplot(data, aes(x=data[, xvar], y=data[, yvar], ...)) +   
  geom_boxplot()  + 
  labs(title=paste("Box plot of", xvar, "by", yvar), x =xvar, y = yvar)+ 
  theme(plot.title = element_text(color = "black", size = 15, face = "bold",hjust = 0.5))
}
```
```{r}
boxplot(mtcars, "cyl", y="disp" ,fill=mtcars$am)
```


```{r}
horizontal_boxplot <- function(data, xvar, yvar, ...) {
ggplot(data, aes(x=data[, xvar], y=data[, yvar], ...)) +   
  geom_boxplot()  + 
  labs(title=paste("Box plot of", xvar, "by", yvar), x =xvar, y = yvar)+ 
  theme(plot.title = element_text(color = "black", size = 15, face = "bold",hjust = 0.5))+ coord_flip()
}
```
```{r}
horizontal_boxplot(mtcars, "cyl", y="disp" ,fill=mtcars$am)
```


# correlation


```{r}

correlation_plot <- function(data, sig.level = 0.01){
col <- colorRampPalette(c("#BB4444", "#EE9988", "#FFFFFF", "#77AADD", "#4477AA"))
tp <- Filter(is.numeric, data)
M<-cor(tp)


# mat : is a matrix of data
cor.mtest <- function(mat, ...) {
    mat <- as.matrix(mat)
    n <- ncol(mat)
    p.mat<- matrix(NA, n, n)
    diag(p.mat) <- 0
    for (i in 1:(n - 1)) {
        for (j in (i + 1):n) {
            tmp <- cor.test(mat[, i], mat[, j], ...)
            p.mat[i, j] <- p.mat[j, i] <- tmp$p.value
        }
    }
  colnames(p.mat) <- rownames(p.mat) <- colnames(mat)
  p.mat
}
# matrix of the p-value of the correlation
p.mat <- cor.mtest(tp)



corrplot(M, method="color", col=col(200),  
         type="upper", order="hclust", 
         addCoef.col = "black", # Add coefficient of correlation
         tl.col="black", tl.srt=45, #Text label color and rotation
         # Combine with significance
         p.mat = p.mat, sig.level = sig.level, insig = "blank", 
         # hide correlation coefficient on the principal diagonal
         diag=FALSE , title = "Correlation Plot"
         )
}
#http://www.sthda.com/english/wiki/visualize-correlation-matrix-using-correlogram
```

```{r}
correlation_plot(mtcars)
```

